<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" class="no-js " lang="en">
<head>
<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <meta name="description" content="Responsive Bootstrap 4 and web Application ui kit.">

    <title>医生注册页面</title>
    <!-- Favicon-->
    <link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">
    <!-- Custom Css -->
    <link rel="stylesheet" th:href="@{/assets/plugins/bootstrap/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/assets/css/main.css}">
    <link rel="stylesheet" th:href="@{/assets/css/authentication.css}">
    <link rel="stylesheet" th:href="@{/assets/css/color_skins.css}">

    <script src="https://unpkg.zhimg.com/axios/dist/axios.min.js"></script>
    <script src="//unpkg.zhimg.com/vue@latest/dist/vue.min.js"></script>
    <script src="//unpkg.zhimg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.js"></script>
</head>

<body class="theme-purple authentication sidebar-collapse">
<!-- Navbar -->
<nav class="navbar navbar-expand-lg fixed-top navbar-transparent">
    <div class="container">        
        <div class="navbar-translate n_logo">
            <a class="navbar-brand" href="javascript:void(0);" title="" target="_blank"><h4>MHealth</h4></a>
            <button class="navbar-toggler" type="button">
                <span class="navbar-toggler-bar bar1"></span>
                <span class="navbar-toggler-bar bar2"></span>
                <span class="navbar-toggler-bar bar3"></span>
            </button>
        </div>
        <div class="navbar-collapse">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <h4></h4>
                    <a class="nav-link btn btn-white btn-round" th:href="@{/doctor}" href="sign-up.html">登录</a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<!-- End Navbar -->
<div class="page-header">
    <div class="page-header-image" style="background-image:url(/mhealth/assets/images/login.jpg)"></div>
    <div class="container">
        <div class="col-md-12 content-center">
            <div id="signUp" class="card-plain">
                <form class="form" method="post" th:action="@{/stu/register}">
                    <div class="header">
                        <div class="logo-container">
                            <img th:src="@{/assets/images/logo.svg}" alt="">
                        </div>
                        <h5>医生注册</h5>
                        <!-- <span>Register a new membership</span> -->
                    </div>
                    <div class="content">
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="请输入工号" name="doctorNumber" v-model="doctorNumber">
                            <span class="input-group-addon">
                                <i class="zmdi zmdi-account-circle"></i>
                            </span>
                        </div>
                        <div style="color: #ff7878" v-model="text1">{{text1}}</div>

                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="请输入用户名" name="username" v-model="username">
                            <span class="input-group-addon">
                                <i class="zmdi zmdi-account-circle"></i>
                            </span>
                        </div>
                        <div style="color: #ff7878" v-model="text2">{{text2}}</div>

                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="请输入邮箱" name="email" v-model="email">
                            <span class="input-group-addon">
                                <i class="zmdi zmdi-email"></i>
                            </span>
                        </div>
                        <div style="color: #ff7878" v-model="text3">{{text3}}</div>

                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="请输入电话" name="tel" v-model="tel">
                            <span class="input-group-addon">
                                <i class="zmdi zmdi-phone"></i>
                            </span>
                        </div>
                        <div style="color: #ff7878" v-model="text4">{{text4}}</div>

                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="请输入年龄" name="age" v-model="age">
                            <span class="input-group-addon">
                                <i class="zmdi zmdi-email"></i>
                            </span>
                        </div>
                        <div style="color: #ff7878" v-model="text5">{{text5}}</div>

                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="请输入教龄" name="teachYears" v-model="teachYears">
                            <span class="input-group-addon">
                                <i class="zmdi zmdi-email"></i>
                            </span>
                        </div>
                        <div style="color: #ff7878" v-model="text6">{{text6}}</div>

                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="请输入毕业院校" name="graduatedSchool" v-model="graduatedSchool">
                            <span class="input-group-addon">
                                <i class="zmdi zmdi-email"></i>
                            </span>
                        </div>
                        <div style="color: #ff7878" v-model="text7">{{text7}}</div>

                        <div class="input-group">
                            <input type="password" placeholder="请输入密码" class="form-control" name="password1"  v-model="password1"/>
                            <span class="input-group-addon">
                                <i class="zmdi zmdi-lock"></i>
                            </span>
                        </div>
                        <div style="color: #ff7878" v-model="text8">{{text8}}</div>

                        <div class="input-group">
                            <input type="password" placeholder="重新确认密码" class="form-control" v-model="password2"/>
                            <span class="input-group-addon">
                                <i class="zmdi zmdi-lock"></i>
                            </span>
                        </div>
                        <div style="color: #ff7878" v-model="text9">{{text9}}</div>
                    </div>

                    <div class="footer text-center">
                        <!--注意使用b-button,否则vue不能操作bootstrap-->
                        <b-button class="btn btn-primary btn-round btn-lg btn-block waves-effect waves-light" @click="submitForm">SIGN UP</b-button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <footer class="footer">
        <div class="container">
            <nav>
                <ul>
                    <li><a href="http://thememakker.com/contact/" target="_blank">Contact Us</a></li>
                    <li><a href="http://thememakker.com/about/" target="_blank">About Us</a></li>
                    <li><a href="javascript:void(0);">FAQ</a></li>
                </ul>
            </nav>
            <div class="copyright">
                &copy;
                <script>
                    document.write(new Date().getFullYear())
                </script>,
                <span><a href="#" target="_blank">网工1703魏佳</a>&nbsp设计</span>
            </div>
        </div>
    </footer>
</div>

<!-- Jquery Core Js -->
<script th:src="@{/assets/bundles/libscripts.bundle.js}"></script>
<script th:src="@{/assets/bundles/vendorscripts.bundle.js}"></script> <!-- Lib Scripts Plugin Js -->

<script th:inline="javascript">

    var app = new Vue({
        el: "#signUp",
        data:{
            flag: 0,
            doctorNumber:"",
            username: "",
            email: "",
            tel:"",
            age:"",
            teachYears:"",
            graduatedSchool:"",
            password1: "",
            password2: "",
            text1: "",
            text2: "",
            text3: "",
            text4: "",
            text5: "",
            text6: "",
            text7: "",
            text8: "",
            text9: "",
            doctor: {}
        },
        methods:{
            submitForm: async function () {

                this.flag = 0;
//                注意加this,表示vue与页面绑定的对象,以及如何判空
                if($.isEmptyObject(this.doctorNumber)){
                    this.text1 = "教师工号不能为空"
                }else {
                    this.flag++;
                    this.text1 = "";
                }

                if($.isEmptyObject(this.username)){
                    this.text2 = "用户名不能为空"
                }else{
                    this.flag++;
                    this.text2 = ""
                }

                if($.isEmptyObject(this.email)){
                    this.text3 = "邮箱不能为空"
                }else{
                    this.flag++
                    this.text3 = ""
                }

                if($.isEmptyObject(this.tel)){
                    this.text4 = "电话不能为空"
                }else{
                    this.flag++
                    this.text4 = ""
                }

                if($.isEmptyObject(this.age)){
                    this.text5 = "年龄不能为空"
                }else{
                    this.flag++
                    this.text5=""
                }

                if($.isEmptyObject(this.teachYears)){
                    this.text6 = "教龄不能为空"
                }else{
                    this.flag++;
                    this.text6 = ""
                }

                if($.isEmptyObject(this.graduatedSchool)){
                    this.text7 = "毕业院校不能为空"
                }else{
                    this.flag++;
                    this.text7 = ""
                }

                if($.isEmptyObject(this.password1)){
                    this.text8 = "密码不能为空"
                }else{
                    this.flag++;
                    this.text8 = ""
                }

                if(!(this.password1 === this.password2)){
                    this.text9 = "密码输入不正确"
                }else{
                    this.flag++;
                    this.text9=""
                }
                if(this.flag === 9){

                    _this = this;
                    try{
                        await axios.get("/mhealth/doctor/doctorChecked1?doctorNumber=" + this.doctorNumber)
                                       .then(res => {
                                           _this.doctor = res.data
                                       })
                    }catch(err){
                        console.log(err);
                        alert("请求出错")
                    }

                    console.log(this.doctor)

                    if(!$.isEmptyObject(this.doctor)){
                        alert($.isEmptyObject(this.doctor))
                        this.text1 = "该工号已注册"
                    }else{

//                      post提交表单

                        let formdata = new FormData()
                        formdata.append("doctorNumber",this.doctorNumber);
                        formdata.append("name",this.username);
                        formdata.append("password",this.password1);
                        formdata.append("email",this.email);
                        formdata.append("tel",this.tel);
                        formdata.append("age",this.age);
                        formdata.append("teachYears",this.teachYears);
                        formdata.append("graduatedSchool",this.graduatedSchool);

                        let config = {
                            headers: {
                                'Content-Type': 'multipart/form-data'
                            }
                        }

                        //异步提交表单，实现数据插入，即使有返回页面，也不会实现页面跳转
                        axios.post('/mhealth/doctor/register',formdata,config).then(res => {
                            alert("提交表单")
                        })

                        location.href="/mhealth/doctor";
                    }
                }
            }
        }
    })

</script>
</body>
</html>